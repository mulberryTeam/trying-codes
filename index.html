<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>لوحة الموظف - نظام إدارة الأعمال</title>
  <!-- رابط خطوط Google -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
  <!-- أيقونات Font Awesome -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
  <!-- إضافة مكتبة Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <style>


:root {
  --secondary-color: #3498db; /* أو أي لون تريده لإطار البطاقة */
}



    /* خلفية الفيديو */
    #bgVideo {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
    }
    /* قواعد عامة */
    body {
      font-family: 'Roboto', sans-serif;
      background: transparent;
      margin: 0;
      padding: 20px;
      transition: background 0.3s ease;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .header-left {
      display: flex;
      align-items: center;
    }
    .header-logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-left: 10px;
    }
    .logout-btn {
      padding: 8px 16px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .logout-btn:hover { 
      background: #c0392b;
      transform: scale(1.05);
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }
    /* قائمة الألسنة */
    .tab-nav {
      display: flex;
      border-bottom: 2px solid #ddd;
      margin-bottom: 20px;
      overflow-x: auto;
    }
    .tab-nav button {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .tab-nav button:hover { background: #f0f0f0; }
    .tab-nav button.active {
      border-bottom: 3px solid #3498db;
      font-weight: bold;
    }
    
    /* واجهة التحليلات - فلتر المبيعات */
    .filter-section {
      margin-bottom: 20px;
      padding: 20px;
      background: #f0f4f8;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }
    .filter-section:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .filter-section label {
      margin-right: 10px;
      font-weight: 500;
    }
    .filter-section input {
      margin-right: 10px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border 0.3s ease;
    }
    .filter-section input:focus {
      border-color: #3498db;
      outline: none;
    }
    .filter-section button {
      padding: 8px 16px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .filter-section button:hover { 
      background: #2980b9;
      transform: scale(1.03);
    }
    /* بطاقة المبيعات */
    .sales-card {
      background: #f7f9fc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow-x: auto;
      transition: box-shadow 0.3s ease;
    }
    .sales-card:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .sales-card table {
      width: 100%;
      border-collapse: collapse;
    }
    .sales-card th, .sales-card td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    .sales-card th { 
      background: #3498db; 
      color: #fff;
      font-weight: bold;
    }
    .sales-summary {
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
    }
    /* واجهة الإعدادات */
    .account-settings {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }
    .account-settings:hover {
      box-shadow: 0 6px 14px rgba(0,0,0,0.15);
    }
    .account-settings h3 { margin-top: 0; }
    .account-settings label { display: block; margin-top: 10px; font-weight: 500; }
    .account-settings input[type="text"],
    .account-settings input[type="password"],
    .account-settings input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border 0.3s ease;
    }
    .account-settings input:focus {
      border-color: #3498db;
      outline: none;
    }
    .account-settings button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .account-settings button:hover { 
      background: #2980b9;
      transform: scale(1.03);
    }
    /* استجابة لجميع الأجهزة */
    @media (max-width: 768px) {
      .container { padding: 20px; }
      .header { flex-direction: column; align-items: flex-start; }
      .logout-btn { width: 100%; text-align: center; }
      .tab-nav button { font-size: 14px; }
    }

.workplan-instructions p {
  font-weight: bold;
  font-family: 'Roboto', sans-serif;
  font-size: 16px;
  margin-bottom: 15px;
}


/* إزالة نقاط القائمة وحذف المسافات الافتراضية */
#productList {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* صندوق الفئة اليومية */
#productList li {
  display: inline-block;
  padding: 10px 20px;
  margin-top: 10px;
  border: 2px solid #8e44ad;       /* إطار بنفسجي */
  border-radius: 8px;
  background-color: #f8e5fa;        /* خلفية فاتحة بنفسجية خفيفة */
  font-weight: bold;
  font-size: 18px;
  color: #8e44ad;                   /* نص بنفسجي */
}


/* 1. نخلي المربع ثابت أسفل الشاشة */
.motivational-container {
  background-color: #f8e5fa;
  border: 2px solid #8e44ad;
  border-radius: 8px;
  padding: 15px;
  margin-top: 0px;        /* مسافة بينه وبين اسم الفئة */
  margin-bottom: 0px;     /* مسافة من أسفل البطاقة */
}





/* 3. شكل النص داخل المربع */
.motivational-header {
  display: flex;
  align-items: center;
  font-weight: bold;
  font-size: 20px;
  margin-bottom: 10px;
}

.motivational-header .emoji {
  margin-left: 8px;
}

.motivational-text p {
  font-weight: bold;
  margin: 5px 0;
}





/* 3) زيادة المسافة بين اسم الفئة والمربع */
#productList {
  list-style: none;
  padding: 0;
  margin: 0;
  margin-bottom: 100px; /* ⬅️ المسافة بين الفئة والمربع التحفيزي */
}


/* تنسيقات قسم نصائح انستجرامية */
.instagram-tips-section {
  padding: 20px;
  background: #fafafa;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
.instagram-tips-section h3 {
  margin-top: 0;
  color: #C13584; /* لون يشبه شعار انستجرام */
}
.instagram-tips-section ul {
  list-style: disc inside;
  padding-left: 0;
}





/* بطاقات الطلبيات */
.order-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin-bottom: 30px;
}
.order-card {
  background: #fff;
  border: 2px solid var(--secondary-color);
  border-radius: 8px;
  padding: 15px;
  width: 280px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  position: relative;
}
.order-card h3 {
  margin: 0 0 10px;
  font-size: 18px;
}
.order-card p {
  margin: 6px 0;
}
.order-card .status {
  font-weight: bold;
  display: flex;
  align-items: center;
  margin-top: 10px;
}
.order-card .status .emoji {
  margin-left: 6px;
}





.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f3f3;
  border-top: 5px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}





.gender-prompt {
  text-align: center;
  padding: 30px;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  margin: 20px 0;
}

.gender-buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-top: 25px;
}

.gender-btn {
  padding: 20px 40px;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  align-items: center;
  gap: 10px;
}

.gender-btn.male {
  background: #3498db;
  color: white;
}

.gender-btn.female {
  background: #e91e63;
  color: white;
}

.gender-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.gender-btn i {
  font-size: 24px;
}





.category-card {
  background: #fff;
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.category-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  border-bottom: 2px solid #eee;
  padding-bottom: 15px;
}

.category-header i {
  font-size: 24px;
  color: #3498db;
}

.category-badge {
  display: inline-block;
  padding: 10px 20px;
  background: #f8f9fa;
  border-radius: 8px;
  font-weight: bold;
  border: 2px solid #3498db;
  color: #3498db;
}

.info-btn {
  margin-top: 15px;
  padding: 10px 20px;
  background: #27ae60;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.info-btn:hover {
  background: #219a52;
}










/* تنسيقات فاخرة للقادة */
body.leader-theme {
  --secondary-color: #8e44ad;
  background: linear-gradient(45deg, #f8e5fa 0%, #e8d3ff 100%);
  position: relative;
  overflow-x: hidden;
}

body.leader-theme::before {
  content: "";
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background-image: 
    radial-gradient(circle at 70% 30%, rgba(142, 68, 173, 0.1) 20%, transparent 40%),
    linear-gradient(45deg, transparent 60%, rgba(255, 223, 186, 0.2) 100%);
  animation: leader-glow 20s linear infinite;
  z-index: -1;
}

@keyframes leader-glow {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

body.leader-theme .container {
  border: 3px solid #8e44ad;
  box-shadow: 
    0 0 40px rgba(142, 68, 173, 0.3),
    inset 0 0 20px rgba(142, 68, 173, 0.2);
  background: linear-gradient(145deg, #ffffff 0%, #fdfcff 100%);
  backdrop-filter: blur(10px);
}

.leader-badge {
  position: fixed;
  top: 20px;
  left: 20px;
  background: linear-gradient(45deg, #8e44ad, #9b59b6);
  color: #fff;
  padding: 10px 25px;
  border-radius: 30px;
  font-weight: bold;
  box-shadow: 
    0 4px 20px rgba(142, 68, 173, 0.4),
    0 0 15px rgba(255, 255, 255, 0.3) inset;
  display: flex;
  align-items: center;
  gap: 10px;
  border: 2px solid #fff;
  animation: badge-float 3s ease-in-out infinite;
}

@keyframes badge-float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.leader-badge i {
  filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
}

body.leader-theme .header {
  border-bottom: 2px solid #8e44ad;
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(5px);
}

/* ⬇️ أضف هذا الكود الجديد ⬇️ */
.header {
  background: transparent !important;
  backdrop-filter: none !important;
}

body.leader-theme .logout-btn {
  background: linear-gradient(45deg, #9b59b6, #8e44ad);
  position: relative;
  overflow: hidden;
}

body.leader-theme .logout-btn::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, 
    transparent 20%, 
    rgba(255,255,255,0.3) 50%, 
    transparent 80%);
  animation: btn-glow 3s linear infinite;
}

@keyframes btn-glow {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

body.leader-theme .tab.active {
  color: #8e44ad;
  text-shadow: 0 0 10px rgba(142, 68, 173, 0.3);
  border-bottom: 3px solid #8e44ad;
}

body.leader-theme .sales-card th {
  background: linear-gradient(45deg, #8e44ad, #9b59b6);
  letter-spacing: 1px;
}

body.leader-theme .filter-section button {
  background: #9b59b6;
  position: relative;
  overflow: hidden;
  transition: all 0.3s;
}

body.leader-theme .filter-section button:hover {
  background: #8e44ad;
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(142, 68, 173, 0.4);
}

/* توهج خاص على العناصر المهمة */
.leader-glow {
  box-shadow: 0 0 20px rgba(142, 68, 173, 0.4);
  animation: glow-pulse 2s ease-in-out infinite;
}

@keyframes glow-pulse {
  0%, 100% { box-shadow: 0 0 20px rgba(142, 68, 173, 0.4); }
  50% { box-shadow: 0 0 30px rgba(142, 68, 173, 0.6); }
}







body.leader-theme .header-left {
  background: transparent;
}

body.leader-theme .header-logo {
  box-shadow: 0 0 15px rgba(142, 68, 173, 0.3);
}









/* ابدأ الإضافة من هنا */
#leaderBonus {
  background: rgba(255,255,255,0.9);
  padding: 20px;
  border-radius: 15px;
  margin: 25px 0;
  border: 2px solid #8e44ad;
  box-shadow: 0 4px 20px rgba(142, 68, 173, 0.2);
  backdrop-filter: blur(5px);
}

#leaderBonus h3 {
  color: #8e44ad;
  margin-top: 0;
  border-bottom: 2px solid #f0f0f0;
  padding-bottom: 10px;
}

#leaderBonus p {
  font-size: 18px;
  margin: 15px 0;
  font-weight: 500;
}
/* انتهاء الإضافة */




/* ابدأ الإضافة هنا */
#totalEarnings {
  font-size: 20px;
  color: #27ae60;
  font-weight: bold;
  border-top: 2px solid #eee;
  padding-top: 15px;
  margin-top: 15px;
}

#personalProfit {
  color: #2980b9;
}
/* انتهاء الإضافة */







#leaderFilterDisplay {
  background: #f8f9fa;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #8e44ad;
  margin: 10px 0;
}












/* بطاقات مكافآت الموظف */
.reward-section {
  width: 100%;
}
.reward-card {
  position: relative;
  width: 260px;
  padding: 16px;
  border: 2px solid #4caf50;
  border-radius: 12px;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.5);
  background: #fff;
  overflow: hidden;
  font-family: 'Roboto', sans-serif;
}
.reward-card__icon {
  position: absolute;
  top: -10px; right: -10px;
  font-size: 2.2rem;
  color: #4caf50;
  font-weight: bold;
}
.reward-card__content {
  text-align: center;
  padding-top: 10px;
}
.reward-card__type {
  font-size: 1rem;
  margin-bottom: 6px;
  color: #333;
}
.reward-card__amount {
  font-size: 1.8rem;
  font-weight: bold;
  margin-bottom: 4px;
  color: #4caf50;
}
.reward-card__date {
  font-size: 0.8rem;
  color: #777;
}
.reward-card__nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  font-size: 1.4rem;
  color: #4caf50;
  cursor: pointer;
  padding: 4px 8px;
}
.reward-card__nav.prev { left: 6px; }
.reward-card__nav.next { right: 6px; }
.reward-card__nav:hover {
  transform: translateY(-50%) scale(1.2);
  transition: transform 0.2s;
}
/* أنيميشن للانتقال */
@keyframes slideLeft { from { transform: translateX(100%); opacity:0; } to { transform: translateX(0); opacity:1; } }
@keyframes slideRight{ from { transform: translateX(-100%); opacity:0; } to { transform: translateX(0); opacity:1; } }
.slide-left  { animation: slideLeft 0.2s ease; }
.slide-right { animation: slideRight 0.2s ease; }







  </style>
</head>
<body>
  <!-- خلفية الفيديو -->
  <video autoplay muted loop id="bgVideo">
    <source src="https://cdn.dribbble.com/userupload/28774288/file/large-0f5d92145d706df70e061ebbf838fa27.mp4" type="video/mp4">
    متصفحك لا يدعم تشغيل الفيديو.
  </video>
  
  <div class="header">
    <div class="header-left">
      <img class="header-logo" id="employeePhotoDisplay"
     src="https://cdn-icons-png.flaticon.com/512/8053/8053444.png"
     alt="صورة الموظف">

      <h1 id="employeeNameDisplay">لوحة الموظف</h1>
    </div>
    <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
  </div>
  <div class="container">
    <!-- قائمة الألسنة مع زر الترجمة -->
    <div class="tab-nav">
      <button id="tabAnalyticsBtn" class="active" onclick="showEmployeeTab('analytics', event)">تحليلات</button>
   <button id="tabWorkPlanBtn" onclick="showEmployeeTab('workplan', event)">خطة العمل</button>
<button id="tabInstagramTipsBtn" onclick="showEmployeeTab('instagramTips', event)">نصائح انستجرامية</button>
<button id="tabOrdersBtn" onclick="showEmployeeTab('orders', event)">الطلبيات</button>



      
    </div>
    
    <!-- واجهة التحليلات -->
    <div id="analytics" class="employee-tab" style="display: block;">
      <div class="filter-section">
        <span id="filterLabel">تصفية المبيعات حسب:</span>
        <label id="radioDayLabel">
          <input type="radio" name="filterType" value="day" checked onclick="toggleFilterInputs('day')"> يوم
        </label>
        <label id="radioMonthLabel">
          <input type="radio" name="filterType" value="month" onclick="toggleFilterInputs('month')"> شهر
        </label>
        <label id="radioPeriodLabel">
          <input type="radio" name="filterType" value="period" onclick="toggleFilterInputs('period')"> فترة مخصصة
        </label>
        <div id="filterDay" style="margin-top:10px;">
          <input type="date" id="filterDayInput">
        </div>
        <div id="filterMonth" style="margin-top:10px; display:none;">
          <input type="month" id="filterMonthInput">
        </div>
        <div id="filterPeriod" style="margin-top:10px; display:none;">
          <label>من:</label>
          <input type="date" id="filterStartDate">
          <label>إلى:</label>
          <input type="date" id="filterEndDate">
        </div>
        <button onclick="loadSalesData(); loadRewards();">تطبيق التصفية</button>

      </div>
      <h2 id="salesHeader">بيانات المبيعات والأرباح الخاصة بك</h2>



<button id="calculatePointsBtn" onclick="calculatePoints()" style="margin-left:10px; padding:5px 10px; background:#2980b9; color:#fff; border:none; border-radius:5px;">
  احتساب النقاط
</button>



















<h3 id="employeeTargetDisplay" style="color:#27ae60; margin-bottom: 15px;"></h3><!-- بطاقة مكافآت الموظف -->
<div id="rewardSection" class="reward-section" style="display: flex; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
  <!-- نص توضيحي صغير -->
  <p class="reward-desc" style="font-size: 0.85rem; color: #555; margin-top: 4px;">
    هذه البطاقة تعرض ملخّص مكافآتك لهذا الشهر.
  </p>
  <!-- البطاقة نفسها -->
  <div id="rewardCard" class="reward-card">
    <div class="reward-card__icon">+</div>
    <div class="reward-card__content">
      <div class="reward-card__type">نوع المكافأة</div>
      <div class="reward-card__amount">₪0</div>
      <div class="reward-card__date">—</div>
    </div>
    <button class="reward-card__nav prev">&lt;</button>
    <button class="reward-card__nav next">&gt;</button>
  </div>
</div>


      <div id="salesData" class="sales-card">
        <!-- يتم تحميل جدول المبيعات هنا -->
      </div>
      <div class="sales-summary" id="salesSummary"></div>


<!-- ابدأ الإضافة من هنا -->
<div id="leaderBonus" style="display: none;">
  <h3>مكافأة القيادة (10%) 🏆</h3>
  <p>إجمالي أرباح الفريق: <span id="teamTotal">0.00</span> ₪</p>
  <p>نصيبك من الأرباح: <span id="leaderPercentage">0.00</span> ₪</p>
<!-- ابدأ الإضافة هنا -->
<p>أرباحك الشخصية: <span id="personalProfit">0.00</span> ₪</p>
<p>المجموع الكلي: <span id="totalEarnings">0.00</span> ₪</p>
<!-- انتهاء الإضافة -->
</div>
<!-- انتهاء الإضافة -->



    </div>
    
 <!-- واجهة خطة العمل -->
 <div id="workplan" class="employee-tab" style="display: none;">
   <div class="workplan-section">
     <h3>خطة العمل اليومية</h3>

     <div id="genderPrompt" class="gender-prompt">
  <h3>مرحبًا! بداية جديدة 💪</h3>
  <p>اختر جنسك لنساعدك في تخصيص خطتك:</p>
  <div class="gender-buttons">
    <button class="gender-btn male" onclick="setGender('male')">
      <i class="fas fa-mars"></i>
      ذكر
    </button>
    <button class="gender-btn female" onclick="setGender('female')">
      <i class="fas fa-venus"></i>
      أنثى
    </button>
  </div>
</div>
 <div id="planContent" style="display: none;">



  <div id="planInstructions" class="workplan-instructions">
    <p><strong>شرح تقسيم الوقت:</strong> اختر يومًا في الأسبوع أو ساعة في اليوم لتحضير المحتوى للنشر، ووزّع وقتك بحيث تخصص كل يوم/ساعة لفئة منتج مختلفة.</p>
  </div>
  <h4>الفئة الموصى بها لهذا اليوم:</h4>
  <ul id="productList"></ul>

<!-- بداية المربع التحفيزي -->
<div class="motivational-container">
  <p class="motivational-header">
    <strong>من القلب للقلب</strong>
    <span class="emoji">❤️</span>
  </p>
  <div class="motivational-text">
    <p><strong>هالدرب ما بيطلب جري، بيطلب استمرار</strong></p>
    <p><strong>“شوية شوية” تمشي خطوة بخطوة، وبالراحة تكسب الخبرة.</strong></p>
    <p><strong>كل يوم خذ فكرة صغيرة، جرّبها وانشرها، وبكرة ضبّط أفكار جديدة.</strong></p>
    <p><strong>حتى لو وقعت، قوم وضحك: “قطرة قطرة بتحف الصخر”.</strong></p>
    <p><strong>المهم تظل تبعثر طاقة وإصرار، والصبر مرة ولحظته حلوة.</strong></p>
    <p><strong>امشي يوم ورا يوم، وبابتسامة خفيفة، رح تلحق نجاح كبير!</strong></p>
  </div>
</div>
<!-- نهاية المربع التحفيزي -->

</div>

   </div>
 </div>
<!-- بداية قسم نصائح انستجرامية -->
<div id="instagramTips" class="employee-tab" style="display: none;">
  <div class="instagram-tips-section">
    <h3>نصائح انستجرامية</h3>
    <ul id="instagramTipsList">
      
  <li>
    <strong>كيف تعمل خوارزمية إنستجرام</strong>
    <ul>
      <li>الأولوية للمحتوى القريب من المستخدمين</li>
      <li>كل ما يتفاعل الجمهور مع منشوراتك (إعجاب، تعليق، حفظ، مشاركة) أسرع، خوارزمية إنستا تطلع محتواك لناس أكثر.</li>
      <li>التوقيت مهم: أول ساعة بعد النشر تحدد مدى انتشارك.</li>
    </ul>
  </li>
  <li>
    <strong>توقّع السلوك</strong>
    <ul>
      <li>إنستا تحاول تعرف أي نوع محتوى يعجب متابعينك: إذا تفاعلوا أكثر مع الريلز، بتزيد أولوية الريلز.</li>
    </ul>
  </li>
  <li>
    <strong>الاستمرارية معيار رئيسي</strong>
    <ul>
      <li>حساب نشط بنشر بانتظام (يوميًّا أو كل يومين) بيكسب ثقة الخوارزمية.</li>
    </ul>
  </li>
</ul>

      <!-- مواعيد النشر المناسبة -->
    <h4>مواعيد النشر المناسبة:</h4>
    <table class="instagram-tips-table" style="width:100%; border-collapse: collapse; margin-bottom: 15px;">
      <thead>
        <tr>
          <th style="border: 1px solid #ddd; padding: 8px; background: #f0f0f0;">نوع المحتوى</th>
          <th style="border: 1px solid #ddd; padding: 8px; background: #f0f0f0;">أنسب الوقت بنشره</th>
          <th style="border: 1px solid #ddd; padding: 8px; background: #f0f0f0;">ملاحظات</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="border: 1px solid #ddd; padding: 8px;">ريلز Reels</td>
          <td style="border: 1px solid #ddd; padding: 8px;">١٠–١٢ ظهرًا &amp; ٧–٩ مساءً</td>
          <td style="border: 1px solid #ddd; padding: 8px;">جمهور يتصفح للترفيه قبل الغداء وبعد الشغل/الدراسة</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 8px;">المنشورات Posts</td>
          <td style="border: 1px solid #ddd; padding: 8px;">٨–١٠ صباحًا &amp; ٥–٧ مساءً</td>
          <td style="border: 1px solid #ddd; padding: 8px;">لحظات التصفح الصباحية والمسائية</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 8px;">القصص Stories</td>
          <td style="border: 1px solid #ddd; padding: 8px;">طوال اليوم (تركيز بين ١٢–٣ عصرًا)</td>
          <td style="border: 1px solid #ddd; padding: 8px;">حافظ على ظهور مستمرّ بين متابعينك</td>
        </tr>
      </tbody>
    </table>

    <!-- نصيحة احترافية -->
    <p style="font-weight: bold; font-size: 16px; line-height: 1.4; margin-top: 10px;">
      نصيحة احترافية: جرّب تتابع تحليلات حسابك (Insights) وتضبط الأوقات حسب جمهورك بالضبط؛ لكل حساب إيقاعه الخاص.
    </p>
    <!-- أسلوب التقديم القلبي -->
    <h4 style="font-weight: bold; margin-top: 20px;">أسلوب التقديم القلبي:</h4>
    <ul style="margin-top: 10px; line-height: 1.6;">
      <li><strong>استخدم صورك الشخصية</strong></li>
      <li>لقعدة بالقهوة، أو في الجامعة، أو ماشي في الشارع…</li>
      <li>ضع صورة المنتج بشكل أنيق فوق خلفيتك الطبيعية، مثلاً ملصق صغير (sticker) أو فريم بسيط.</li>
      <li><strong>احكي قصة قصيرة وشاركها مع متابعينك من حياتك</strong></li>
      <li>لغة بسيطة، صوتك الحقيقي، وكأنك عم تحكي لصاحبك.</li>
      <li><strong>خلي المحتوى إنساني</strong></li>
      <li>إضحك وابتسم، اشتغل بلقطات candid (غير مصطنعة)، تفاعل مع متابعينك بالـ stickers والـ polls.</li>
    </ul>

    <!-- اختصار الفكرة وجاذبيتها -->
    <h4 style="font-weight: bold; margin-top: 20px;">اختصار الفكرة وجاذبيتها:</h4>
    <ul style="margin-top: 10px; line-height: 1.6;">
      <li><strong>شرح شورت وفوري</strong></li>
      <li>لا تزيد عن ٣ جمل في التعليق: “المرطب هذا خفيف جدًا على البشرة، بياخد لون طبيعي وبيحافظ على الترطيب.”</li>
      <li>استخدم emojis لتقسيم النص (🌿✨💧).</li>
      <li>ستيكرات تفاعل وأسئلة وستيكر الخيارات</li>
      <li>مثلاً: “مين جرب عطر نيكسا بديل برادا؟ خبروني!”</li>
      <li>“احفظوا الصورة عشان ترجعوا لها وقت الحاجة.”</li>
    </ul>

    <!-- كيف تزيد التفاعل والوصول -->
    <h4 style="font-weight: bold; margin-top: 20px;">كيف تزيد التفاعل والوصول:</h4>
    <ul style="margin-top: 10px; line-height: 1.6;">
      <li><strong>استغلّ الـ Hashtags بذكاء</strong></li>
      <li>٥–٧ هاشتاغات متخصصة (مثلاً #جمال_طبيعي #mulberry #aaup #SkinCare)</li>
      <li>فهم الـ niche يلي بتنشر فيه واستخدم هاشتاغات متداولة عند جمهورك.</li>
      <li><strong>انشر على الستوري بكثرة</strong></li>
      <li>قصص تفاعلية (استبيان، سؤال، شريط تمرير).</li>
      <li>رابط مباشر للمنتج (Swipe Up أو Sticker الرابط).</li>
      <li><strong>تعاون مع حسابات صغيرة (Micro-influencers)</strong></li>
      <li>تبادل “تاج” أو “Shoutout” لزيادة الظهور.</li>
      <li><strong>تابع وتفاعل مع جمهورك</strong></li>
      <li>إرفع إشعارات تعليقاتك ورد عليها خلال ساعة.</li>
      <li>خليك متابع لبوستاتهم وحط لايك وتعليق حتى يردوا لك الجميل.</li>
      <li><strong>عيد نشر المحتوى بحالة جديدة</strong></li>
      <li>خذ نفس الفيديو ريلز وقطّع منه مقطع ستوري، أو انسخ أهم جمل الإعلان في بوست ثابت.</li>
    </ul>

    <!-- أهم شيء تفتكرّه -->
    <p style="font-weight: bold; font-size: 18px; margin-top: 20px; line-height: 1.5;">
      🥇 أهم شيء تفتكرّه:<br>
      “المحتوى القريب من قلب المشاهد + الشرح القصير والواضح = تفاعل أعلى وانتشار أسرع.”<br>
      امشي على هالنصايح، وجرب كل عنصر بخفة وروح مرحة، ومع الاستمرارية رح تلاقي حسابك عم يكبر وانت عم تستمتع بالتجربة!
    </p>

  </div>
</div>
<!-- نهاية قسم نصائح انستجرامية -->


    




<!-- Orders Tab -->
<div id="orders" class="employee-tab" style="display: none;">
  <h2 style="margin-bottom:15px;">الطلبيات الخاصة بك</h2>
  <div id="ordersContainer" class="order-cards"></div>
</div>







  </div>
  
  <script>
    // إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAi3_y7ugKB0cgzMV1-IVvbE2BwG_9RKSs",
      authDomain: "team-analysis-3c196.firebaseapp.com",
      databaseURL: "https://team-analysis-3c196-default-rtdb.firebaseio.com",
      projectId: "team-analysis-3c196",
      storageBucket: "team-analysis-3c196.firebasestorage.app",
      messagingSenderId: "38968485922",
      appId: "1:38968485922:web:667832a4aa77599ba8a6fb",
      measurementId: "G-853WkH2JK7"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();


    // تهيئة Firestore
    const firestore = firebase.firestore();

    // إعداد الترجمة
    let currentLanguage = 'ar';
    const translations = {
      ar: {
        employeeDashboard: "لوحة الموظف",
        welcome: "أهلاً, ",
        logout: "تسجيل الخروج",
        tabAnalytics: "تحليلات",
        tabSettings: "الإعدادات",
        filterLabel: "تصفية المبيعات حسب:",
        radioDay: "يوم",
        radioMonth: "شهر",
        radioPeriod: "فترة مخصصة",
        salesHeader: "بيانات المبيعات والأرباح الخاصة بك",
        tableHeaders: {
          product: "المنتج",
          sale: "سعر البيع (₪)",
          date: "التاريخ"
        },
        salesSummary: (totalSales, totalProfit) => `إجمالي المبيعات: ${totalSales} | إجمالي الأرباح: ₪${totalProfit}`,
        settingsHeader: "إعدادات الحساب",
        changeUsername: "تغيير اسم المستخدم:",
        changePassword: "تغيير كلمة المرور:",
        changePhoto: "تغيير الصورة الشخصية:",
        updateSettings: "تحديث الإعدادات",
        langToggle: "",
        chatInputPlaceholder: "اكتب رسالتك..."
      },
      en: {
        employeeDashboard: "Employee Dashboard",
        welcome: "Welcome, ",
        logout: "Logout",
        tabAnalytics: "Analytics",
        tabSettings: "Settings",
        filterLabel: "Filter Sales By:",
        radioDay: "Day",
        radioMonth: "Month",
        radioPeriod: "Custom Period",
        salesHeader: "Your Sales & Profit Data",
        tableHeaders: {
          product: "Product",
          sale: "Sale Price (₪)",
          date: "Date"
        },
        salesSummary: (totalSales, totalProfit) => `Total Sales: ${totalSales} | Total Profit: ₪${totalProfit}`,
        settingsHeader: "Account Settings",
        changeUsername: "Change Username:",
        changePassword: "Change Password:",
        changePhoto: "Change Personal Photo:",
        updateSettings: "Update Settings",
        langToggle: "",
        chatInputPlaceholder: "Type your message..."
      }
    };

    // استرجاع اسم الموظف المخزن في localStorage
    let employeeName = localStorage.getItem('employeeName');



const empKey = localStorage.getItem('employeeKey');

// فحص وجود الحساب كل 3 ثواني بشكل آمن
if (empKey) {
  setInterval(() => {
    database.ref('employeeAccounts/' + empKey).once('value')
      .then(snapshot => {
        if (!snapshot.exists()) {
          logout(); // تم حذف الحساب => تسجيل خروج
        }
      })
      .catch(error => {
        console.error("خطأ في الفحص التلقائي:", error);
      });
  }, 3000);
}





    if (!employeeName) {
      alert("لم يتم العثور على جلسة الموظف. الرجاء تسجيل الدخول مرة أخرى.");
      window.location.href = "index.html";
    }





    document.getElementById('employeeNameDisplay').textContent = translations[currentLanguage].welcome + employeeName;








// ✅ ابدأ من هنا بإضافة كود التحقق من القيادة
let isLeader = false;

database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
  .then(snapshot => {
    snapshot.forEach(child => {
      const data = child.val();
      if (data.leader) {
  isLeader = true;
  document.body.classList.add('leader-theme');
  
  const badge = document.createElement('div');
  badge.className = 'leader-badge leader-glow';
  badge.innerHTML = `
    <i class="fas fa-crown"></i>
    <span>قائد الفريق المميز</span>
    <div class="badge-sparkles"></div>
  `;
  
  // إضافة تأثير الشرارات
  const sparkles = document.createElement('div');
  sparkles.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  `;
  document.body.prepend(sparkles, badge);
  
  // توليد شرارات متحركة
  setInterval(() => {
    const spark = document.createElement('div');
    spark.style.cssText = `
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      top: ${Math.random() * 100}%;
      left: ${Math.random() * 100}%;
      animation: spark-fall ${2 + Math.random() * 3}s linear infinite;
    `;
    spark.innerHTML = `<style>
      @keyframes spark-fall {
        0% { transform: translateY(-100vh); opacity: 1; }
        100% { transform: translateY(100vh); opacity: 0; }
      }
    </style>`;
    sparkles.appendChild(spark);
    setTimeout(() => spark.remove(), 3000);
  }, 100);
}
    });
  })
  .then(() => {
    // الكود الأصلي لعدد النقاط
    database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
    .then(snapshot => {
      snapshot.forEach(child => {
        const data = child.val();
        const points = data.target || 0;
// ابدأ الإضافة من هنا
if (data.leader) {
  isLeader = true;
  document.body.classList.add('leader-theme');
  // ... (الكود السابق لإضافة الشارة)
  showLeaderBonus(child.key); // ⬅️ هذه الإضافة الجديدة
}
// انتهاء الإضافة
        document.getElementById('employeeTargetDisplay').textContent = `عدد النقاط الحالية: ${points} نقطة`;
      });
    });
  });






database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
  .then(snapshot => {
    snapshot.forEach(child => {
      const data = child.val();
      const points = data.target || 0;
      document.getElementById('employeeTargetDisplay').textContent = `عدد النقاط الحالية: ${points} نقطة`;
    });
  });


    

    // استرجاع تعيينات البائع المميز
    let topSellerDesignations = {};
    database.ref('topSellerDesignations').on('value', snapshot => {
      topSellerDesignations = snapshot.val() || {};
    });

    // دالة المساعدة للحصول على نسبة البائع المميز
    function getTopSellerRate(empName, saleDate) {
      let rate = 0.5; // القيمة الافتراضية للموظف العادي
      for (const key in topSellerDesignations) {
        const des = topSellerDesignations[key];
        if (des.employee === empName) {
          const start = new Date(des.startDate);
          const end = new Date(des.endDate);
          const saleDt = new Date(saleDate);
          if (saleDt >= start && saleDt <= end) {
            rate = 0.6;
            break;
          }
        }
      }
      return rate;
    }

    // تحميل بيانات المبيعات مع حساب الأرباح (تم حذف عمود السعر الأصلي)
    function loadSalesData() {
      // الحصول أولاً على نوع الموظف من Realtime Database
      database.ref('employees').orderByChild('name').equalTo(employeeName).once('value')
      .then(empSnapshot => {
        let employeeType = "regular";
        empSnapshot.forEach(child => { employeeType = child.val().type; });
        // جلب بيانات المبيعات الخاصة بالموظف
        database.ref('sales').orderByChild('seller').equalTo(employeeName).once('value')
        .then(snapshot => {
          const salesData = snapshot.val() || {};
          let totalSales = 0;
          let totalProfit = 0;
          // إنشاء الجدول بدون عمود السعر الأصلي
          let tableHTML = `<table><tr>
            <th>${translations[currentLanguage].tableHeaders.product}</th>
            <th>${translations[currentLanguage].tableHeaders.sale}</th>
            <th>${translations[currentLanguage].tableHeaders.date}</th>
            </tr>`;
          const filterType = document.querySelector('input[name="filterType"]:checked').value;
let filterFn = sale => true;

// ✅ فلترة افتراضية: عرض الشهر الحالي إذا ما تم اختيار أي تواريخ
if (!document.getElementById('filterDayInput').value &&
    !document.getElementById('filterMonthInput').value &&
    !document.getElementById('filterStartDate').value &&
    !document.getElementById('filterEndDate').value) {
  const today = new Date();
  const year = today.getFullYear();
  const month = (today.getMonth() + 1).toString().padStart(2, '0');
  const currentMonth = `${year}-${month}`;
  filterFn = sale => sale.date.startsWith(currentMonth);
}


          if (filterType === "day") {
            const day = document.getElementById('filterDayInput').value;
            if (day) { filterFn = sale => sale.date.slice(0,10) === day; }
          } else if (filterType === "month") {
            const month = document.getElementById('filterMonthInput').value;
            if (month) { filterFn = sale => sale.date.startsWith(month); }
          } else if (filterType === "period") {
            const start = new Date(document.getElementById('filterStartDate').value);
            const end = new Date(document.getElementById('filterEndDate').value);
            if(document.getElementById('filterStartDate').value && document.getElementById('filterEndDate').value) {
              filterFn = sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= start && saleDate <= end;
              };
            }
          }
          for (const key in salesData) {
            const sale = salesData[key];
            if (!filterFn(sale)) continue;
            totalSales++;
            const rawProfit = parseFloat(sale.salePrice) - parseFloat(sale.originalPrice);
            let percentage = 0.5; // القيمة الافتراضية
            if (employeeType === "distinguished") {
              percentage = 0.7;
            } else if (employeeType === "regular") {
              percentage = getTopSellerRate(employeeName, sale.date);
            }
            totalProfit += rawProfit * percentage;
            tableHTML += `<tr>
              <td>${sale.productName}</td>
              <td>₪${sale.salePrice}</td>
              <td>${new Date(sale.date).toLocaleDateString()}</td>
              </tr>`;
          }
          tableHTML += "</table>";
          document.getElementById('salesData').innerHTML = tableHTML;
          document.getElementById('salesSummary').innerHTML = `<p>${translations[currentLanguage].salesSummary(totalSales, totalProfit.toFixed(2))}</p>`;
        });
      });
    }
    loadSalesData();

    // تبديل عرض مدخلات الفلترة
    function toggleFilterInputs(type) {
      document.getElementById('filterDay').style.display = (type === 'day') ? 'block' : 'none';
      document.getElementById('filterMonth').style.display = (type === 'month') ? 'block' : 'none';
      document.getElementById('filterPeriod').style.display = (type === 'period') ? 'block' : 'none';
    }

 
// ابدأ الإضافة من هنا
async function calculateTeamProfit(leaderKey) {
  try {
    const filterFn = createDateFilter(); // استخدام الدالة المشتركة
    const leaderSnapshot = await database.ref(`employees/${leaderKey}`).once('value');
    const leaderData = leaderSnapshot.val();

    if (!leaderData.team) return 0;

    const allEmployees = (await database.ref('employees').once('value')).val();
    let totalProfit = 0;

    for (const memberKey of leaderData.team) {
      const member = allEmployees[memberKey];
      if (!member) continue;

      const sales = (await database.ref('sales')
        .orderByChild('seller')
        .equalTo(member.name)
        .once('value')).val();

      for (const key in sales) {
        const sale = sales[key];
        if (filterFn(sale)) { // تطبيق الفلترة هنا
          totalProfit += (sale.salePrice - sale.originalPrice) * 0.5;
        }
      }
    }

    return totalProfit;

  } catch (error) {
    console.error("فشل حساب أرباح الفريق:", error);
    return 0;
  }
}

async function showLeaderBonus(leaderKey) {
  if (!isLeader) return;

  try {
    const filterFn = createDateFilter(); // نفس الدالة المشتركة
    
    // حساب أرباح الفريق
    const teamProfit = await calculateTeamProfit(leaderKey);
    
    // حساب الأرباح الشخصية مع نفس الفلترة
    const personalSales = (await database.ref('sales')
      .orderByChild('seller')
      .equalTo(employeeName)
      .once('value')).val();

    let personalProfit = 0;
    for (const key in personalSales) {
      const sale = personalSales[key];
      if (filterFn(sale)) { // تطبيق نفس الفلترة
        personalProfit += (sale.salePrice - sale.originalPrice) * 0.5;
      }
    }

    // تحديث الواجهة
    document.getElementById('leaderBonus').style.display = 'block';
    document.getElementById('teamTotal').textContent = teamProfit.toFixed(2);
    document.getElementById('leaderPercentage').textContent = (teamProfit * 0.1).toFixed(2);
    document.getElementById('personalProfit').textContent = personalProfit.toFixed(2);
    document.getElementById('totalEarnings').textContent = (personalProfit + (teamProfit * 0.1)).toFixed(2);

  } catch (error) {
    console.error("فشل عرض مكافأة القائد:", error);
  }
}
// انتهاء الإضافة
   



    /* ------------------ تغيير الألسنة ------------------ */
    function showEmployeeTab(tabName, event) {
      document.querySelectorAll('.employee-tab').forEach(tab => tab.style.display = 'none');
      document.querySelectorAll('.tab-nav button').forEach(btn => btn.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById(tabName).style.display = 'block';
if (tabName === 'orders') {
    loadOrders();
  }
    }

   


function loadOrders() {
  const container = document.getElementById('ordersContainer');

  database.ref('orders').on('value', snap => {
    const allOrders = snap.val() || {};const data = Object.entries(allOrders)
  .filter(([id, o]) =>
    o.employee &&
    o.employee.toLowerCase().trim() === employeeName.toLowerCase().trim()
  )
  .sort((a, b) => {
    const dateA = new Date(a[1].date);
    const dateB = new Date(b[1].date);
    return dateB - dateA; // الأحدث أولاً
  });


    container.innerHTML = '';
    const shownOrders = {};

    if (data.length === 0) {
      container.innerHTML = '<p>لا توجد طلبيات حالياً.</p>';
      return;
    }

    data.forEach(([id, order]) => {
      if (shownOrders[id]) return;
      shownOrders[id] = true;

      let emoji = '⏳';
      if (order.status === 'قيد التوصيل') emoji = '🚚';
      else if (order.status === 'تم الاستلام') emoji = '✔️';

      let productsHTML = '<ul style="padding-left:16px;margin:10px 0;">';
      if (Array.isArray(order.products)) {
        order.products.forEach(p => {
          productsHTML += `<li>${p.name} — ₪${parseFloat(p.price).toFixed(2)}</li>`;
        });
      } else {
        productsHTML += '<li>لا توجد منتجات مسجلة</li>';
      }
      productsHTML += '</ul>';

      const card = document.createElement('div');
      card.className = 'order-card';
      card.innerHTML = `
        <h3>تفاصيل الطلبية</h3>
        <p>عدد المنتجات: ${order.count}</p>
        ${productsHTML}
        <p>نوع التوصيل: ${order.type}${order.type === 'delivery' ? ` (₪${order.deliveryPrice})` : ''}</p>
        <p>المجموع: ₪${parseFloat(order.total).toFixed(2)}</p>
        <p class="status">الحالة: ${order.status}<span class="emoji">${emoji}</span></p>
      `;
      container.appendChild(card);
    });
  }, err => {
    console.error("خطأ بجلب الطلبيات:", err);
    container.innerHTML = '<p>حدث خطأ أثناء جلب الطلبيات.</p>';
  });
}



// استدعاء loadOrders عند الضغط على تبويب "الطلبيات"
document.getElementById('tabOrdersBtn').addEventListener('click', () => {
  loadOrders();
});







    /* ------------------ تسجيل الخروج ------------------ */
    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

// ====== بيانات فئات خطة العمل ======
const workPlanCategories = {
  male: [
    "معالجات وسيروم للوجه","مرطبات وكريمات للوجه","البشرة والوجه",
    "منتجات الحلاقة للرجال","منتجات العناية للرجال","مزيلات عرق للرجال",
    "عطور","عطور للرجال","تصفيف الشعر","غسولات","سيروم وزيوت للشعر",
    "شامبو","العناية بالشعر","الوقاية من الشمس والتسمير","العناية بالأسنان",
    "العناية بالفم"
  ],
  female: [
    "العناية بالجسم","مرطب للجسم","البشرة والوجه","مرطبات وكريمات للوجه",
    "معطر للجسم","مقشرات وملمعات الجسم","مستلزمات العناية الشخصية",
    "معالجات وسيروم للوجه","منتجات تقشير الجسم","تفتيح","عطور للنساء","عطور",
    "العناية بالقدم","النظافة الشخصية للنساء","صابون استحمام","العناية باليدين",
    "أقنعة الوجه","الوجه","الوقاية من الشمس والتسمير",
    "العناية بالأسنان","العناية بالفم","إزالة الشعر",
    "العناية بالحوامل والمرضعة","مزيلات عرق للنساء"
  ]
};


// ====== ١) إنشاء shuffle ثابت لكل موظف حسب اسمه وجنسه ======
function getEmployeeOrder(gender) {
  // ١. إحضار مصفوفة الفئات
  const cats = [...workPlanCategories[gender]];
  // ٢. بناء seed من اسم الموظف والجنس
  let seed = 0;
  for (let i = 0; i < employeeName.length; i++) {
    seed = (seed * 31 + employeeName.charCodeAt(i)) % 2147483647;
  }
  seed = (seed + (gender === 'male' ? 1 : 2)) % 2147483647;
  // ٣. LCG لتوليد أرقام عشوائية
  let rnd = seed;
  function next() {
    rnd = (rnd * 16807) % 2147483647;
    return (rnd - 1) / 2147483646;
  }
  // ٤. Fisher–Yates shuffle
  for (let i = cats.length - 1; i > 0; i--) {
    const j = Math.floor(next() * (i + 1));
    [cats[i], cats[j]] = [cats[j], cats[i]];
  }
  return cats;
}

// ====== ٢) اختيار الفئة لليوم الحالي من القائمة الكاملة ======
function getCategoryForToday(gender) {
  const order = getEmployeeOrder(gender);
  // حساب عدد الأيام منذ 1 يناير 1970
  const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
  // الموضع في القائمة
  const idx = daysSinceEpoch % order.length;
  return order[idx];
}

// ====== ٣) عرض فئة اليوم فقط ======
function showPlan(gender) {
  const listEl = document.getElementById('productList');
  listEl.innerHTML = '';
  
  const todayCat = getCategoryForToday(gender);
  
  const card = document.createElement('div');
  card.className = 'category-card';
  card.innerHTML = `
    <div class="category-header">
      <i class="fas fa-calendar-day"></i>
      <h4>الفئة الموصى بها ليوم ${new Date().toLocaleDateString('ar-EG')}</h4>
    </div>
    <div class="category-content">
      <span class="category-badge">${todayCat}</span>
      <button class="info-btn" onclick="showCategoryTips('${todayCat}')">
        <i class="fas fa-lightbulb"></i>
        نصائح خاصة
      </button>
    </div>
  `;
  
  listEl.appendChild(card);
  document.getElementById('planContent').style.display = 'block';
}



// حفظ الجنس في Firestore وعرض الخطة
// ====== دالة setGender الجديدة باستخدام Realtime Database ======
function setGender(gender) {
  console.log("setGender called with:", gender);
  // إخفاء واجهة السؤال
  document.getElementById('genderPrompt').style.display = 'none';
  // عرض الخطة فوراً
  showPlan(gender);

  // تحديث فئة gender في الـRealtime Database
  database.ref('employees')
    .orderByChild('name')
    .equalTo(employeeName)
    .once('value')
    .then(snapshot => {
      snapshot.forEach(child => {
        // child.key هو الـ ID لكل موظف
        database.ref('employees/' + child.key)
          .update({ gender: gender })
          .then(() => console.log("Gender saved to Realtime DB"))
          .catch(err => console.error("Error saving gender:", err));
      });
    })
    .catch(err => console.error("Error querying employees:", err));
}





// عند الضغط على تبويب “خطة العمل” (Realtime DB)
document.getElementById('tabWorkPlanBtn').addEventListener('click', () => {
  database.ref('employees')
    .orderByChild('name')
    .equalTo(employeeName)
    .once('value')
    .then(snapshot => {
      let gender = null;
      snapshot.forEach(child => { gender = child.val().gender; });
      if (gender) {
        document.getElementById('genderPrompt').style.display = 'none';
        showPlan(gender);
      } else {
        document.getElementById('genderPrompt').style.display = 'block';
        document.getElementById('planContent').style.display = 'none';
      }
    })
    .catch(err => console.error("Error fetching gender:", err));
});













// ابدأ الإضافة من هنا
if (isLeader) {
  setInterval(async () => {
    const snapshot = await database.ref('employees').orderByChild('name').equalTo(employeeName).once('value');
    snapshot.forEach(child => {
      showLeaderBonus(child.key);
    });
  }, 60000); // كل دقيقة
}
// انتهاء الإضافة













// أضف هذه الدالة في الأعلى مع بقية الدوال الرئيسية
function createDateFilter() {
  const filterType = document.querySelector('input[name="filterType"]:checked').value;
  let filterFn = (sale) => true;
  let startDate, endDate;

  // الفلترة الافتراضية (شهر حالي)
  if (!document.getElementById('filterDayInput').value &&
      !document.getElementById('filterMonthInput').value &&
      !document.getElementById('filterStartDate').value &&
      !document.getElementById('filterEndDate').value) {
    const today = new Date();
    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
  } else {
    switch(filterType) {
      case 'day':
        const day = document.getElementById('filterDayInput').value;
        if (day) {
          startDate = new Date(day);
          endDate = new Date(day);
          endDate.setHours(23, 59, 59);
        }
        break;
      
      case 'month':
        const month = document.getElementById('filterMonthInput').value;
        if (month) {
          const [year, m] = month.split('-');
          startDate = new Date(year, m - 1, 1);
          endDate = new Date(year, m, 0);
        }
        break;
      
      case 'period':
        startDate = new Date(document.getElementById('filterStartDate').value);
        endDate = new Date(document.getElementById('filterEndDate').value);
        break;
    }
  }

  if (startDate && endDate) {
    endDate.setHours(23, 59, 59); // لتشمل اليوم كامل
    filterFn = (sale) => {
      const saleDate = new Date(sale.date);
      return saleDate >= startDate && saleDate <= endDate;
    };
  }

  return filterFn;
}









document.querySelector('.filter-section button').onclick = () => {
  // تطبيق الفلترة على كلا القسمين
  loadSalesData();
  loadRewards();           // ← هنا نعيد تحميل المكافآت حسب الفلتر الجديد

  
  if (isLeader) {
    database.ref('employees')
      .orderByChild('name')
      .equalTo(employeeName)
      .once('value')
      .then(snapshot => {
        snapshot.forEach(child => showLeaderBonus(child.key));
      });
  }
  
  // إظهار الفترة المحددة في قسم القيادة
  const filterFn = createDateFilter();
  const [start, end] = getFilterDates();
  updateLeaderFilterDisplay(start, end);
}

// دالة مساعدة للحصول على التواريخ
function getFilterDates() {
  const filterType = document.querySelector('input[name="filterType"]:checked').value;
  let start, end;
  
  switch(filterType) {
    case 'day':
      start = document.getElementById('filterDayInput').value;
      end = start;
      break;
    case 'month':
      start = document.getElementById('filterMonthInput').value;
      end = start;
      break;
    case 'period':
      start = document.getElementById('filterStartDate').value;
      end = document.getElementById('filterEndDate').value;
      break;
    default:
      const today = new Date();
      start = `${today.getFullYear()}-${(today.getMonth()+1).toString().padStart(2,'0')}`;
      end = start;
  }
  
  return [start, end];
}

// دالة تحديث عرض الفلترة في قسم القيادة
function updateLeaderFilterDisplay(start, end) {
  const displayElement = document.getElementById('leaderFilterDisplay');
  
  if (!displayElement) {
    const newDisplay = document.createElement('div');
    newDisplay.id = 'leaderFilterDisplay';
    newDisplay.style.margin = '10px 0';
    newDisplay.style.fontWeight = 'bold';
    newDisplay.style.color = '#8e44ad';
    document.getElementById('leaderBonus').prepend(newDisplay);
  }
  
  const displayText = start === end 
    ? `الفترة المحددة: ${start}`
    : `الفترة المحددة: من ${start} إلى ${end}`;
  
  document.getElementById('leaderFilterDisplay').textContent = displayText;
}









// دالة احتساب النقاط وتحويلها إلى شيكل
function calculatePoints() {
  // جلب عدد النقاط الحالي من العنصر
  const displayText = document.getElementById('employeeTargetDisplay').textContent;
  // استخراج الرقم من النص (عدد النقاط)
  const points = parseInt(displayText.replace(/\D/g, ''), 10) || 0;
  // حساب المبلغ بالشيكل
  const shekels = (points / 90).toFixed(2);
  // عرض الناتج في نافذة منبثقة
  alert(`قيمة النقاط بالشيكل: ₪${shekels}`);
}

// ربط الزر مع الدالة بعد تحميل الصفحة
document.getElementById('calculatePointsBtn').addEventListener('click', calculatePoints);














// --- بداية كود مكافآت الموظف ---
const rewardCard   = document.getElementById("rewardCard");
const typeEl       = rewardCard.querySelector(".reward-card__type");
const amountEl     = rewardCard.querySelector(".reward-card__amount");
const dateEl       = rewardCard.querySelector(".reward-card__date");
const prevBtn      = rewardCard.querySelector(".reward-card__nav.prev");
const nextBtn      = rewardCard.querySelector(".reward-card__nav.next");

let rewards = [], currentIndex = 0;
const empUid = localStorage.getItem('employeeName');


function loadRewards() {
  const filterFn = createDateFilter();
  database.ref("rewards")
    .orderByChild("employee").equalTo(empUid)
    .once("value")
    .then(snap => {
      rewards = [];
      snap.forEach(s => {
        const r = s.val();
        // ننشئ كائن يشبه sale حتى يعمل filterFn
        if (filterFn({ date: r.date })) {
          rewards.push(r);
        }
      });
      currentIndex = 0;
      renderReward();
      // تحديث ملخص المبيعات بإظهار مجموع المكافآت
      const sum = rewards.reduce((a,b) => a + Number(b.amount), 0);
      const summaryEl = document.getElementById("salesSummary");
      // نحتفظ بالنص الأصلي الموجود داخل <p> ثم نلحق المكافآت
      summaryEl.innerHTML = summaryEl.innerHTML.replace(/<\/?p>/g, '')
                              + `<p> | مكافآت: ₪${sum.toFixed(2)}</p>`;
    })
    .catch(err => console.error("خطأ في تحميل المكافآت:", err));
}


function renderReward() {
  if (!rewards.length) {
    typeEl.textContent = "لا توجد مكافآت";
    amountEl.textContent = "₪0";
    dateEl.textContent   = "";
    prevBtn.style.display = nextBtn.style.display = "none";
    return;
  }
  const r = rewards[currentIndex];
  typeEl.textContent   = `نوع: ${r.type}`;
  amountEl.textContent = `₪${r.amount}`;
  dateEl.textContent   = new Date(r.date).toLocaleDateString("ar-IL");
  prevBtn.style.display = currentIndex > 0                   ? "block" : "none";
  nextBtn.style.display = currentIndex < rewards.length - 1  ? "block" : "none";
}

prevBtn.addEventListener("click", () => {
  if (currentIndex > 0) { currentIndex--; renderReward(); }
});
nextBtn.addEventListener("click", () => {
  if (currentIndex < rewards.length - 1) { currentIndex++; renderReward(); }
});

// ربط فلتر الشهر
document.getElementById("filterMonthInput")
        .addEventListener("change", e => loadRewards(e.target.value));
// التحميل الأولي بناءً على الفلتر الافتراضي (شهر/يوم/فترة)
loadRewards();

// --- نهاية كود مكافآت الموظف ---










  </script>
</body>
</html>
